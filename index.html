<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Navigator OS</title>
    <style>
        :root { --bg: #0b0f1a; --card: #161c2d; --accent: #3b82f6; --text: #e2e8f0; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; }
        
        /* Layout */
        .navbar { display: flex; justify-content: space-between; align-items: center; padding: 15px 30px; background: #111827; border-bottom: 1px solid #1f2937; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; padding: 30px; }
        
        /* Cards */
        .card { background: var(--card); border-radius: 12px; padding: 20px; border: 1px solid #2d3748; transition: 0.2s; position: relative; }
        .card:hover { border-color: var(--accent); transform: translateY(-3px); }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .status-actif { background: #10b981; }
        .status-pause { background: #f59e0b; }
        .status-archive { background: #ef4444; }
        
        .avatar-img { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; background: #334155; }
        
        /* Stats */
        .progress-container { margin: 10px 0; font-size: 12px; }
        .progress-bg { background: #334155; height: 6px; border-radius: 3px; margin-top: 4px; }
        .progress-fill { background: var(--accent); height: 100%; border-radius: 3px; transition: width 0.5s; }

        /* Modal */
        #editor { position: fixed; right: -450px; top: 0; width: 400px; height: 100%; background: #111827; padding: 25px; transition: 0.3s; box-shadow: -5px 0 15px rgba(0,0,0,0.5); z-index: 100; overflow-y: auto; }
        #editor.open { right: 0; }
        input, select, textarea { width: 100%; background: #1f2937; border: 1px solid #374151; color: white; padding: 10px; border-radius: 6px; margin: 8px 0; box-sizing: border-box; }
        .btn { padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; }
        .btn-add { background: var(--accent); color: white; }
    </style>
</head>
<body>

<div class="navbar">
    <div style="font-size: 1.5rem; font-weight: 800; color: var(--accent)">NAVIGATOR <span style="font-weight: 300; color: white;">v5</span></div>
    <div>
        <button class="btn btn-add" id="btn-new" style="display:none" onclick="showEditor(null)">+ Nouveau Dossier</button>
        <button class="btn" onclick="login()" id="btn-login" style="background:#374151; color:white;">Connexion Admin</button>
    </div>
</div>

<div class="grid" id="main-grid"></div>

<div id="editor">
    <h2 id="edit-title">Gestion de Dossier</h2>
    <label>ID Unique</label><input type="text" id="in-id">
    <div style="display:flex; gap:10px;">
        <input type="text" id="in-prenom" placeholder="Pr√©nom">
        <input type="text" id="in-nom" placeholder="Nom">
    </div>
    <label>Cat√©gorie</label>
    <select id="in-cat"><option>Ami</option><option>Travail</option><option>VIP</option><option>Cible</option></select>
    <label>Statut</label>
    <select id="in-status"><option value="actif">Actif</option><option value="pause">En attente</option><option value="archive">Termin√© / Archiv√©</option></select>
    <input type="text" id="in-avatar" placeholder="URL de l'image (Avatar)">
    <textarea id="in-bio" placeholder="Notes confidentielles..." rows="4"></textarea>
    
    <div style="display:flex; justify-content:space-between; align-items:center; margin-top:15px;">
        <b>Statistiques</b>
        <button class="btn" style="background:#374151; font-size:10px;" onclick="addStatRow()">+ Ajouter</button>
    </div>
    <div id="stat-inputs"></div>

    <button class="btn btn-add" style="width:100%; margin-top:20px;" onclick="save()">üíæ Enregistrer</button>
    <button class="btn" style="width:100%; margin-top:10px; background:#7f1d1d;" id="btn-del" onclick="del()">Supprimer</button>
    <button class="btn" style="width:100%; margin-top:10px; background:none; border:1px solid #374151; color:white;" onclick="closeEditor()">Annuler</button>
</div>

<script>
    const API = "https://TON-URL-NGROK.ngrok-free.dev"; // METS TON URL ICI
    let DATA = {};
    let PASS = "";

    async function load() {
        const r = await fetch(`${API}/data`, { headers: {"ngrok-skip-browser-warning":"1"} });
        DATA = await r.json();
        const grid = document.getElementById('main-grid');
        grid.innerHTML = "";
        
        Object.entries(DATA).forEach(([id, d]) => {
            let stats = "";
            Object.entries(d.stats).forEach(([n, v]) => {
                stats += `<div class="progress-container">${n} (${v}%)<div class="progress-bg"><div class="progress-fill" style="width:${v}%"></div></div></div>`;
            });

            grid.innerHTML += `
                <div class="card" onclick="showEditor('${id}')">
                    <div style="display:flex; gap:15px; align-items:center; margin-bottom:15px;">
                        <img src="${d.avatar || 'https://via.placeholder.com/60'}" class="avatar-img">
                        <div>
                            <div style="font-weight:bold">${d.prenom} ${d.nom}</div>
                            <div style="font-size:11px; color:#94a3b8"><span class="status-dot status-${d.status}"></span> ${d.cat} ‚Ä¢ ${d.date}</div>
                        </div>
                    </div>
                    <div style="font-size:13px; color:#cbd5e1; height:40px; overflow:hidden;">${d.bio}</div>
                    <div style="margin-top:15px; border-top:1px solid #1f2937; padding-top:10px;">${stats}</div>
                </div>
            `;
        });
    }

    function showEditor(id) {
        if(!PASS) return alert("Connexion requise");
        document.getElementById('editor').classList.add('open');
        const area = document.getElementById('stat-inputs');
        area.innerHTML = "";

        if(id && DATA[id]) {
            const d = DATA[id];
            document.getElementById('in-id').value = id;
            document.getElementById('in-id').disabled = true;
            document.getElementById('in-prenom').value = d.prenom;
            document.getElementById('in-nom').value = d.nom;
            document.getElementById('in-cat').value = d.cat;
            document.getElementById('in-status').value = d.status;
            document.getElementById('in-avatar').value = d.avatar;
            document.getElementById('in-bio').value = d.bio;
            Object.entries(d.stats).forEach(([k,v]) => addStatRow(k,v));
            document.getElementById('btn-del').style.display = "block";
        } else {
            document.getElementById('in-id').value = "";
            document.getElementById('in-id').disabled = false;
            document.getElementById('in-prenom').value = "";
            document.getElementById('in-nom').value = "";
            document.getElementById('in-bio').value = "";
            addStatRow("Loyaut√©", 50);
            document.getElementById('btn-del').style.display = "none";
        }
    }

    function addStatRow(k="", v=50) {
        const div = document.createElement('div');
        div.className = "st-row";
        div.innerHTML = `<div style="display:flex; gap:5px"><input type="text" value="${k}" class="sn" placeholder="Nom stat" style="flex:2"><input type="number" value="${v}" class="sv" style="flex:1"></div>`;
        document.getElementById('stat-inputs').appendChild(div);
    }

    async function save() {
        const stats = {};
        document.querySelectorAll('.st-row').forEach(r => {
            const n = r.querySelector('.sn').value;
            const v = r.querySelector('.sv').value;
            if(n) stats[n] = parseInt(v);
        });

        const payload = {
            id: document.getElementById('in-id').value,
            prenom: document.getElementById('in-prenom').value,
            nom: document.getElementById('in-nom').value,
            category: document.getElementById('in-cat').value,
            status: document.getElementById('in-status').value,
            bio: document.getElementById('in-bio').value,
            avatar: document.getElementById('in-avatar').value,
            stats: stats, code: PASS
        };

        await fetch(`${API}/update`, {
            method: 'POST', 
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(payload)
        });
        closeEditor(); load();
    }

    async function del() {
        if(!confirm("Supprimer ce dossier d√©finitivement ?")) return;
        await fetch(`${API}/delete`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({id: document.getElementById('in-id').value, code: PASS})
        });
        closeEditor(); load();
    }

    function login() {
        const p = prompt("Code d'acc√®s :");
        if(p === "ExpA22") {
            PASS = p;
            document.getElementById('btn-login').innerText = "Admin Connect√©";
            document.getElementById('btn-new').style.display = "block";
        }
    }

    function closeEditor() { document.getElementById('editor').classList.remove('open'); }

    load();
    setInterval(load, 20000);
</script>
</body>
</html>
