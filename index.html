<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gianni Navigator | Dashboard</title>
    <style>
        :root { --bg: #0b0b14; --card: #161625; --accent: #ff2e63; --text: #eaeaea; --bar-bg: #1f1f33; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: auto; }
        h1 { text-align: center; color: var(--accent); }
        .ami-card { background: var(--card); border-radius: 12px; padding: 20px; margin-bottom: 20px; border-left: 4px solid var(--accent); }
        .stat-block { margin-bottom: 12px; }
        .stat-info { display: flex; justify-content: space-between; font-size: 0.9em; margin-bottom: 4px; }
        .bar-container { background: var(--bar-bg); height: 10px; border-radius: 5px; overflow: hidden; }
        .bar-fill { height: 100%; background: var(--accent); transition: width 0.5s; }
        .admin-box { background: #1a1a2e; padding: 20px; border-radius: 12px; margin-top: 40px; }
        .form-group { display: flex; flex-wrap: wrap; gap: 10px; }
        input, select, button { padding: 10px; border-radius: 5px; border: none; }
        button { background: var(--accent); color: white; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>üìä Gianni Navigator</h1>
    <div id="app">Chargement...</div>

    <div class="admin-box">
        <h3>‚öôÔ∏è Administration</h3>
        <div class="form-group">
            <input type="text" id="target-name" placeholder="Nom">
            <select id="target-stat">
                <option value="R√©putation">R√©putation üåü</option>
                <option value="Bont√©">Bont√© ‚ù§Ô∏è</option>
                <option value="Loyaut√©">Loyaut√© üõ°Ô∏è</option>
            </select>
            <input type="number" id="target-change" placeholder="+/- %">
            <button onclick="sendUpdate()">Appliquer</button>
        </div>
    </div>
</div>

<script>
    // METS TON LIEN NGROK ICI (change √† chaque red√©marrage du serveur)
    const API_URL = "https://economically-pseudoetymological-serenity.ngrok-free.dev";

    async function refreshData() {
        try {
            const response = await fetch(`${API_URL}/stats`, {
                headers: { "ngrok-skip-browser-warning": "69420" }
            });
            const stats = await response.json();
            const app = document.getElementById('app');
            app.innerHTML = "";

            for (const [name, data] of Object.entries(stats)) {
                let card = `<div class="ami-card"><strong>üë§ ${name}</strong><br><br>`;
                for (const [sName, sVal] of Object.entries(data)) {
                    card += `
                        <div class="stat-block">
                            <div class="stat-info"><span>${sName}</span><span>${sVal}%</span></div>
                            <div class="bar-container"><div class="bar-fill" style="width: ${sVal}%"></div></div>
                        </div>`;
                }
                card += `</div>`;
                app.innerHTML += card;
            }
        } catch (err) {
            document.getElementById('app').innerHTML = "Erreur de connexion au serveur.";
            console.error(err);
        }
    }

    async function sendUpdate() {
        const name = document.getElementById('target-name').value;
        const stat = document.getElementById('target-stat').value;
        const val = document.getElementById('target-change').value;

        if (!name || !val) return alert("Champs vides !");

        try {
            await fetch(`${API_URL}/update`, {
                method: 'POST',
                headers: { 
                    'Content-Type': 'application/json',
                    'ngrok-skip-browser-warning': '69420'
                },
                body: JSON.stringify({ami_name: name, stat_name: stat, change: parseInt(val)})
            });
            refreshData();
        } catch (err) {
            alert("Erreur lors de la mise √† jour.");
        }
    }

    refreshData();
    setInterval(refreshData, 5000);
</script>
</body>
</html>
