<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gianni Navigator | Dashboard</title>
    <style>
        :root { --bg: #0b0b14; --card: #161625; --accent: #ff2e63; --text: #eaeaea; --bar-bg: #1f1f33; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; padding: 20px; line-height: 1.6; }
        .container { max-width: 800px; margin: auto; }
        
        h1 { text-align: center; color: var(--accent); text-transform: uppercase; letter-spacing: 2px; }

        .ami-card { background: var(--card); border-radius: 12px; padding: 20px; margin-bottom: 20px; border-left: 4px solid var(--accent); }
        .ami-name { font-size: 1.4em; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }

        .stat-block { margin-bottom: 12px; }
        .stat-info { display: flex; justify-content: space-between; font-size: 0.9em; margin-bottom: 4px; }
        .bar-container { background: var(--bar-bg); height: 10px; border-radius: 5px; overflow: hidden; }
        .bar-fill { height: 100%; background: linear-gradient(90deg, #ff2e63, #ff6b6b); transition: width 0.8s cubic-bezier(0.17, 0.67, 0.83, 0.67); }

        .admin-box { background: #1a1a2e; border: 1px solid #333; padding: 20px; border-radius: 12px; margin-top: 40px; }
        .admin-box h3 { margin-top: 0; color: #08d9d6; }
        .form-group { display: flex; flex-wrap: wrap; gap: 10px; }
        
        input, select, button { padding: 12px; border-radius: 6px; border: none; font-size: 14px; }
        input, select { background: #252545; color: white; flex: 1; min-width: 150px; }
        button { background: var(--accent); color: white; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button:hover { opacity: 0.8; transform: translateY(-2px); }
    </style>
</head>
<body>

<div class="container">
    <h1>üìä Syst√®me Gianni Navigator</h1>
    
    <div id="app"></div>

    <div class="admin-box">
        <h3>‚öôÔ∏è Panneau de Contr√¥le</h3>
        <div class="form-group">
            <input type="text" id="target-name" placeholder="Nom de l'ami (ex: Alex)">
            <select id="target-stat">
                <option value="R√©putation">R√©putation üåü</option>
                <option value="Bont√©">Bont√© ‚ù§Ô∏è</option>
                <option value="Loyaut√©">Loyaut√© üõ°Ô∏è</option>
                <option value="Humour">Humour üòÇ</option>
                <option value="Soutien">Soutien ü§ù</option>
                <option value="Fiabilit√©">Fiabilit√© ‚úÖ</option>
            </select>
            <input type="number" id="target-change" placeholder="+/- % (ex: 5)">
            <button onclick="sendUpdate()">Appliquer</button>
        </div>
    </div>
</div>

<script>
    // TON ADRESSE SERVEUR
    const API_URL = "http://fi6.bot-hosting.net:21443";

    async function refreshData() {
        try {
            const response = await fetch(`${API_URL}/stats`);
            const stats = await response.json();
            const app = document.getElementById('app');
            app.innerHTML = "";

            if (Object.keys(stats).length === 0) {
                app.innerHTML = "<p style='text-align:center; opacity:0.5;'>Aucune donn√©e. Ajoutez un ami ci-dessous !</p>";
                return;
            }

            for (const [name, data] of Object.entries(stats)) {
                let card = `<div class="ami-card"><div class="ami-name">üë§ ${name}</div>`;
                for (const [sName, sVal] of Object.entries(data)) {
                    card += `
                        <div class="stat-block">
                            <div class="stat-info"><span>${sName}</span><span>${sVal}%</span></div>
                            <div class="bar-container"><div class="bar-fill" style="width: ${sVal}%"></div></div>
                        </div>`;
                }
                card += `</div>`;
                app.innerHTML += card;
            }
        } catch (err) {
            console.error("Erreur serveur :", err);
        }
    }

    async function sendUpdate() {
        const name = document.getElementById('target-name').value;
        const stat = document.getElementById('target-stat').value;
        const val = document.getElementById('target-change').value;

        if (!name || !val) return alert("Remplis tous les champs !");

        await fetch(`${API_URL}/update`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ami_name: name, stat_name: stat, change: parseInt(val)})
        });
        
        document.getElementById('target-change').value = ""; // Reset champ
        refreshData();
    }

    // Chargement initial et rafra√Æchissement auto toutes les 10 sec
    refreshData();
    setInterval(refreshData, 10000);
</script>

</body>
</html>
